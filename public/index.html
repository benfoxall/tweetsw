<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Tweet SW</title>
    </head>
    <body>
        <h1>Tweet SW</h1>

        <ul id="tweets">
        </ul>

        <script src="pusher.js"></script>
        <script>
            fetch('/key')
                .then(function(r) {
                    return r.text()
                })
                .then(function(key){
                    var pusher = new Pusher(key, {
                        encrypted: true
                    });
                    var channel = pusher.subscribe('all');
                    channel.bind('tweet', function(data) {

                        var li = document.createElement('li');
                        li.innerText = data.text;
                        tweets.insertBefore( li, tweets.firstChild );

                        // way more data here
                        console.log("tweet", data);
                    });
                })
        </script>
    </body>
</html>
